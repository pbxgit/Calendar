<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Dashboard</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FullCalendar CSS -->
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css' rel='stylesheet' />
    <style>
        body {
            background-color: #f8f9fa;
        }
        .section {
            display: none;
        }
        .active-section {
            display: block;
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Personal Dashboard</a>
            <div id="auth-links" class="d-flex">
                <!-- Auth buttons will be injected here -->
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Authentication Section -->
        <div id="auth-section" class="active-section">
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <h2 class="card-title text-center">Login or Sign Up</h2>
                            <div class="mb-3">
                                <label for="email" class="form-label">Email address</label>
                                <input type="email" class="form-control" id="email" placeholder="name@example.com">
                            </div>
                            <div class="mb-3">
                                <label for="password" class="form-label">Password</label>
                                <input type="password" class="form-control" id="password" placeholder="Password">
                            </div>
                            <div class="d-grid gap-2">
                                <button id="login-btn" class="btn btn-primary">Login</button>
                                <button id="signup-btn" class="btn btn-secondary">Sign Up</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content (Logged In) -->
        <div id="main-content" class="d-none">
            <ul class="nav nav-tabs">
                <li class="nav-item">
                    <a class="nav-link active" href="#" data-section="history">History Tracker</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-section="calendar">Upcoming Events</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-section="todos">To-Do List</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-section="notes">Notes</a>
                </li>
            </ul>

            <!-- History Tracker -->
            <div id="history-section" class="section active-section p-4 bg-white rounded shadow-sm mt-3">
                <h3>History Tracker</h3>
                <form id="history-form" class="mb-4">
                    <div class="mb-3">
                        <input type="text" id="history-title" class="form-control" placeholder="Title" required>
                    </div>
                    <div class="mb-3">
                        <textarea id="history-desc" class="form-control" placeholder="Description"></textarea>
                    </div>
                    <div class="mb-3">
                        <input type="date" id="history-date" class="form-control" required>
                    </div>
                    <button type="submit" class="btn btn-success">Add History</button>
                </form>
                <ul id="history-list" class="list-group"></ul>
            </div>

            <!-- Calendar -->
            <div id="calendar-section" class="section p-4 bg-white rounded shadow-sm mt-3">
                <h3>Upcoming Events</h3>
                <div id='calendar'></div>
                <h4 class="mt-4">Add New Event</h4>
                <form id="event-form">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <input type="text" id="event-title" class="form-control" placeholder="Event Title" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <input type="date" id="event-date" class="form-control" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-info">Add Event</button>
                </form>
            </div>

            <!-- To-Do List -->
            <div id="todos-section" class="section p-4 bg-white rounded shadow-sm mt-3">
                <h3>To-Do List</h3>
                <form id="todo-form" class="d-flex mb-3">
                    <input type="text" id="todo-input" class="form-control me-2" placeholder="New Task" required>
                    <button type="submit" class="btn btn-primary">Add</button>
                </form>
                <ul id="todo-list" class="list-group"></ul>
            </div>

            <!-- Notes -->
            <div id="notes-section" class="section p-4 bg-white rounded shadow-sm mt-3">
                <h3>Notes</h3>
                <form id="note-form" class="mb-4">
                    <div class="mb-3">
                        <input type="text" id="note-title" class="form-control" placeholder="Note Title" required>
                    </div>
                    <div class="mb-3">
                        <textarea id="note-content" class="form-control" placeholder="Note Content" rows="4"></textarea>
                    </div>
                    <button type="submit" class="btn btn-warning">Save Note</button>
                </form>
                <div id="notes-list" class="row"></div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    
    <!-- FullCalendar JS -->
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.js'></script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // <!-- YOUR FIREBASE CONFIGURATION HERE -->
        const firebaseConfig = {
            apiKey: "AIzaSyBghGrPLr7_iC46u1Phs83vd1i-47zstUs",
  authDomain: "calendar-pbx21.firebaseapp.com",
  projectId: "calendar-pbx21",
  storageBucket: "calendar-pbx21.firebasestorage.app",
  messagingSenderId: "304190482123",
  appId: "1:304190482123:web:2a8415125467565a1e9d4e",
  measurementId: "G-YCNG7QXRR2"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let calendar; // To hold the FullCalendar instance
        let currentUserId = null;

        document.addEventListener('DOMContentLoaded', function() {
            const authSection = document.getElementById('auth-section');
            const mainContent = document.getElementById('main-content');
            const authLinks = document.getElementById('auth-links');

            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUserId = user.uid;
                    authSection.classList.remove('active-section');
                    authSection.style.display = 'none';
                    mainContent.classList.remove('d-none');
                    authLinks.innerHTML = `<button id="logout-btn" class="btn btn-danger">Logout</button>`;
                    document.getElementById('logout-btn').addEventListener('click', () => auth.signOut());
                    
                    initializeDashboard();
                } else {
                    currentUserId = null;
                    authSection.classList.add('active-section');
                    authSection.style.display = 'block';
                    mainContent.classList.add('d-none');
                    authLinks.innerHTML = '';
                }
            });

            // Auth buttons
            document.getElementById('login-btn').addEventListener('click', () => {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                auth.signInWithEmailAndPassword(email, password).catch(error => alert(error.message));
            });

            document.getElementById('signup-btn').addEventListener('click', () => {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                auth.createUserWithEmailAndPassword(email, password).catch(error => alert(error.message));
            });
            
            // Navigation
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('.section');
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    navLinks.forEach(l => l.classList.remove('active'));
                    sections.forEach(s => s.classList.remove('active-section'));
                    
                    link.classList.add('active');
                    document.getElementById(link.dataset.section + '-section').classList.add('active-section');
                });
            });

        });

        function initializeDashboard() {
            // Initialize Calendar
            const calendarEl = document.getElementById('calendar');
            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,listWeek'
                },
                events: []
            });
            calendar.render();

            loadHistory();
            loadEvents();
            loadTodos();
            loadNotes();
            setupEventListeners();
        }

        function setupEventListeners() {
            // History Form
            document.getElementById('history-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const title = document.getElementById('history-title').value;
                const description = document.getElementById('history-desc').value;
                const date = document.getElementById('history-date').value;
                
                db.collection('users').doc(currentUserId).collection('history').add({
                    title,
                    description,
                    date: firebase.firestore.Timestamp.fromDate(new Date(date)),
                });
                e.target.reset();
            });

            // Event Form
            document.getElementById('event-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const title = document.getElementById('event-title').value;
                const start = document.getElementById('event-date').value;
                
                db.collection('users').doc(currentUserId).collection('events').add({ title, start });
                e.target.reset();
            });

            // To-Do Form
            document.getElementById('todo-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const task = document.getElementById('todo-input').value;
                
                db.collection('users').doc(currentUserId).collection('todos').add({
                    task,
                    completed: false,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                e.target.reset();
            });

            // Note Form
            document.getElementById('note-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const title = document.getElementById('note-title').value;
                const content = document.getElementById('note-content').value;
                
                db.collection('users').doc(currentUserId).collection('notes').add({
                    title,
                    content,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                e.target.reset();
            });
        }

        function loadHistory() {
            const list = document.getElementById('history-list');
            db.collection('users').doc(currentUserId).collection('history').orderBy('date', 'desc').onSnapshot(snapshot => {
                list.innerHTML = '';
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const item = document.createElement('li');
                    item.className = 'list-group-item';
                    item.innerHTML = `<h5>${data.title} - ${new Date(data.date.seconds * 1000).toLocaleDateString()}</h5><p>${data.description}</p>`;
                    list.appendChild(item);
                });
            });
        }

        function loadEvents() {
            db.collection('users').doc(currentUserId).collection('events').onSnapshot(snapshot => {
                const events = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                calendar.removeAllEvents();
                calendar.addEventSource(events);
            });
        }

        function loadTodos() {
            const list = document.getElementById('todo-list');
            db.collection('users').doc(currentUserId).collection('todos').orderBy('createdAt', 'desc').onSnapshot(snapshot => {
                list.innerHTML = '';
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const item = document.createElement('li');
                    item.className = 'list-group-item d-flex justify-content-between align-items-center';
                    item.innerHTML = `<span style="${data.completed ? 'text-decoration: line-through;' : ''}">${data.task}</span>`;
                    
                    const buttons = document.createElement('div');
                    const toggleBtn = document.createElement('button');
                    toggleBtn.className = `btn btn-sm ${data.completed ? 'btn-secondary' : 'btn-success'}`;
                    toggleBtn.textContent = data.completed ? 'Undo' : 'Complete';
                    toggleBtn.onclick = () => db.collection('users').doc(currentUserId).collection('todos').doc(doc.id).update({ completed: !data.completed });
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'btn btn-sm btn-danger ms-2';
                    deleteBtn.textContent = 'Delete';
                    deleteBtn.onclick = () => db.collection('users').doc(currentUserId).collection('todos').doc(doc.id).delete();
                    
                    buttons.appendChild(toggleBtn);
                    buttons.appendChild(deleteBtn);
                    item.appendChild(buttons);
                    list.appendChild(item);
                });
            });
        }

        function loadNotes() {
            const list = document.getElementById('notes-list');
            db.collection('users').doc(currentUserId).collection('notes').orderBy('createdAt', 'desc').onSnapshot(snapshot => {
                list.innerHTML = '';
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const col = document.createElement('div');
                    col.className = 'col-md-4 mb-3';
                    col.innerHTML = `
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">${data.title}</h5>
                                <p class="card-text">${data.content.substring(0, 100)}...</p>
                                <button class="btn btn-sm btn-danger" onclick="deleteNote('${doc.id}')">Delete</button>
                            </div>
                        </div>
                    `;
                    list.appendChild(col);
                });
            });
        }
        
        function deleteNote(id) {
            if (confirm('Are you sure you want to delete this note?')) {
                db.collection('users').doc(currentUserId).collection('notes').doc(id).delete();
            }
        }
    </script>
</body>
</html>
